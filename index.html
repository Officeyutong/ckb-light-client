<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.js"></script>
    <!-- <script src="./light-client-js/dist/index.js"></script> -->
    <script type="module">
        import * as CkbLightClient from "./light-client-js/dist/index.js";
        const LightClient = CkbLightClient.LightClient;
        console.log(LightClient);
        console.log(CkbLightClient);
        window.initWorkers = async (spec = "./test/config.toml") => {
            const config = await (await fetch(spec)).text();
            $("#init-button").addClass("loading");
            const client = new CkbLightClient.LightClient();
            window.client = client;
            await client.start(
                {
                    type: "TestNet",
                    config,
                },
                "0xc1993c60556fe01da6a9c11651638c885d04e7c093f74697bb0233fae0bc2577",
                "info"
            );

            $("#init-button").removeClass("loading");
            return client;
        };
        window.doTest = async () => {
            await window.client.setScripts([{ script: { codeHash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8", hashType: "type", args: "0xc422a38cbadc4a59c688e7558f3d398294e0bec2", }, scriptType: "lock", blockNumber: "0xef3b5c" }], 0)
            console.log(await window.client.getCellsCapacity({ script: { codeHash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8", hashType: "type", args: "0xc422a38cbadc4a59c688e7558f3d398294e0bec2" }, scriptType: "lock" }))
            console.log(await window.client.getCells({ script: { codeHash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8", hashType: "type", args: "0xc422a38cbadc4a59c688e7558f3d398294e0bec2" }, scriptType: "lock" }))
            console.log(await window.client.getTransactions({ script: { codeHash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8", hashType: "type", args: "0xc422a38cbadc4a59c688e7558f3d398294e0bec2" }, scriptType: "lock" }))
        };
        window.doTest2 = async () => {
            const cells = await window.client.getCells({
                script: {
                    codeHash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
                    hashType: "type",
                    args: "0xef0273afa67242b1b407eced450f78b2c02a2a23"
                }, scriptType: "lock"
            }, "asc", 1);
            return await window.client.getCells({
                script: {
                    codeHash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
                    hashType: "type",
                    args: "0xef0273afa67242b1b407eced450f78b2c02a2a23"
                }, scriptType: "lock"
            }, "asc", 1, cells.lastCursor);
        }
        window.doTest3 = async () => {
            await window.client.setScripts([{ script: { codeHash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8", hashType: "type", args: "0x1ba33f7d6e216d015fae119719ecabf4c08cdc4a", }, scriptType: "lock", blockNumber: "15730953" }], 0);
            return await window.client.getTransactions(
                {
                    script: { codeHash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8", hashType: "type", args: "0x1ba33f7d6e216d015fae119719ecabf4c08cdc4a", groupByTransactions: true },
                    scriptType: "lock"
                }, "desc"
            )
        }
        window.doTest4 = async () => {
            await window.client.setScripts([{ script: { codeHash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8", hashType: "type", args: "0xef0273afa67242b1b407eced450f78b2c02a2a23", }, scriptType: "lock", blockNumber: 12112687n }], 0);
            return await window.client.getTransactions({
                script: {
                    codeHash: "0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",
                    hashType: "type",
                    args: "0xef0273afa67242b1b407eced450f78b2c02a2a23",
                },
                scriptType: 'lock',
                groupByTransaction: true
            }, "asc", "0x2", "0x609bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce801ef0273afa67242b1b407eced450f78b2c02a2a230000000000b8d344000000010000000000");
        };
    </script>

</head>

<body>
    <div style="margin-top: 10%;margin-left: 10%;margin-right: 10%;">
        <button class="ui button" id="init-button" onclick="initWorkers()">Initialize workers</button>
        <div class="ui divider"></div>

    </div>
</body>

</html>
